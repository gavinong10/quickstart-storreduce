{
    "Conditions": {
        "GovCloudCondition": {
            "Fn::Equals": [
                {
                    "Ref": "AWS::Region"
                },
                "us-gov-west-1"
            ]
        },
        "NumInstancesLessThanOrEqualTo10": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        10
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo9"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo11": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        11
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo10"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo12": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        12
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo11"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo13": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        13
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo12"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo14": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        14
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo13"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo15": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        15
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo14"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo16": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        16
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo15"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo17": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        17
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo16"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo18": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        18
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo17"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo19": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        19
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo18"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo20": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        20
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo19"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo21": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        21
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo20"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo22": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        22
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo21"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo23": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        23
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo22"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo24": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        24
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo23"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo25": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        25
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo24"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo26": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        26
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo25"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo27": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        27
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo26"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo28": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        28
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo27"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo29": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        29
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo28"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo30": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        30
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo29"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo31": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        31
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo30"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo4": {
            "Fn::Equals": [
                {
                    "Ref": "NumSRRHosts"
                },
                4
            ]
        },
        "NumInstancesLessThanOrEqualTo5": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        5
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo4"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo6": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        6
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo5"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo7": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        7
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo6"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo8": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        8
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo7"
                }
            ]
        },
        "NumInstancesLessThanOrEqualTo9": {
            "Fn::Or": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "NumSRRHosts"
                        },
                        9
                    ]
                },
                {
                    "Condition": "NumInstancesLessThanOrEqualTo8"
                }
            ]
        },
        "SSLCertificateIdIsUndefined": {
            "Fn::Equals": [
                {
                    "Ref": "SSLCertificateId"
                },
                ""
            ]
        }
    },
    "Mappings": {
        "AWSAMIRegion": {
            "ap-northeast-1": {
                "AMI": "ami-13b85075",
                "MonitorAMI": "ami-1bbd557d"
            },
            "ap-northeast-2": {
                "AMI": "ami-1d0ed773",
                "MonitorAMI": "ami-bb0fd6d5"
            },
            "ap-south-1": {
                "AMI": "ami-f584ff9a",
                "MonitorAMI": "ami-76fb8019"
            },
            "ap-southeast-1": {
                "AMI": "ami-6e61ff0d",
                "MonitorAMI": "ami-8b60fee8"
            },
            "ap-southeast-2": {
                "AMI": "ami-f4776e97",
                "MonitorAMI": "ami-07766f64"
            },
            "ca-central-1": {
                "AMI": "ami-88e957ec",
                "MonitorAMI": "ami-93e856f7"
            },
            "eu-central-1": {
                "AMI": "ami-32e9475d",
                "MonitorAMI": "ami-b0e846df"
            },
            "eu-west-1": {
                "AMI": "ami-eadb2c93",
                "MonitorAMI": "ami-27da2d5e"
            },
            "eu-west-2": {
                "AMI": "ami-e8d6c78c",
                "MonitorAMI": "ami-33dacb57"
            },
            "sa-east-1": {
                "AMI": "ami-5f522433",
                "MonitorAMI": "ami-865422ea"
            },
            "us-east-1": {
                "AMI": "ami-c5ae8dbe",
                "MonitorAMI": "ami-73b29108"
            },
            "us-east-2": {
                "AMI": "ami-2afbdb4f",
                "MonitorAMI": "ami-11f8d874"
            },
            "us-west-1": {
                "AMI": "ami-7e73581e",
                "MonitorAMI": "ami-7c73581c"
            },
            "us-west-2": {
                "AMI": "ami-b88a6cc0",
                "MonitorAMI": "ami-b6886ece"
            }
        }
    },
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "StorReduce Configuration"
                    },
                    "Parameters": [
                        "KeyPairName",
                        "StorReducePassword",
                        "ShardsNum",
                        "ReplicaShardsNum",
                        "InstanceType",
                        "MonitorInstanceType",
                        "BucketName",
                        "NumSRRHosts",
                        "StorReduceLicense",
                        "SSLCertificateId",
                        "DomainName",
                        "ValidationDomainName"
                    ]
                },
                {
                    "Label": {
                        "default": "Network Configuration"
                    },
                    "Parameters": [
                        "NumberOfAZs",
                        "VpcId",
                        "VPCCIDR",
                        "RemoteAccessCIDR",
                        "PrivateSubnetsToSpan",
                        "PublicSubnetsToSpan"
                    ]
                },
                {
                    "Label": {
                        "default": "AWS Quick Start Configuration"
                    },
                    "Parameters": [
                        "QSS3BucketName",
                        "QSS3KeyPrefix"
                    ]
                }
            ],
            "ParameterLabels": {
                "BastionAMIOS": {
                    "default": "Bastion AMI Operating System"
                },
                "BastionInstanceType": {
                    "default": "Bastion Instance Type"
                },
                "BucketName": {
                    "default": "Bucket Name"
                },
                "DomainName": {
                    "default": "Domain Name"
                },
                "InstanceType": {
                    "default": "Instance Type"
                },
                "KeyPairName": {
                    "default": "Key Pair Name"
                },
                "MonitorInstanceType": {
                    "default": "Monitor Instance Type"
                },
                "NumBastionHosts": {
                    "default": "Number of Bastion Hosts"
                },
                "NumSRRHosts": {
                    "default": "Number of StorReduce servers"
                },
                "NumberOfAZs": {
                    "default": "Number of Availability Zones"
                },
                "PrivateSubnetsToSpan": {
                    "default": "VPC Private Subnets"
                },
                "PublicSubnetsToSpan": {
                    "default": "VPC Public Subnets"
                },
                "QSS3BucketName": {
                    "default": "Quick Start S3 Bucket Name"
                },
                "QSS3KeyPrefix": {
                    "default": "Quick Start S3 Key Prefix"
                },
                "RemoteAccessCIDR": {
                    "default": "External Allowed Access CIDR"
                },
                "ReplicaShardsNum": {
                    "default": "Number of Replica Shards"
                },
                "SSLCertificateId": {
                    "default": "SSL Certificate ID"
                },
                "ShardsNum": {
                    "default": "Number of Shards"
                },
                "StorReduceLicense": {
                    "default": "StorReduce license"
                },
                "StorReducePassword": {
                    "default": "StorReduce Password"
                },
                "VPCCIDR": {
                    "default": "VPC CIDR"
                },
                "ValidationDomainName": {
                    "default": "Validation Domain Name"
                },
                "VpcId": {
                    "default": "VPC ID"
                }
            }
        }
    },
    "Outputs": {
        "ElasticLoadBalancerID": {
            "Description": "ElasticLoadBalancerID ID",
            "Value": {
                "Ref": "ElasticLoadBalancer"
            }
        }
    },
    "Parameters": {
        "BucketName": {
            "ConstraintDescription": "must be a valid S3 bucket name.",
            "Description": "The bucket to which StorReduce will store data",
            "Type": "String"
        },
        "DomainName": {
            "Description": "The Domain Name to be used to generate an SSL certificate (not required if SSLCertificateId exists)",
            "Type": "String"
        },
        "InstanceType": {
            "AllowedValues": [
                "i3.xlarge",
                "i3.2xlarge",
                "i3.4xlarge",
                "i3.8xlarge",
                "i3.16xlarge"
            ],
            "ConstraintDescription": "must be a valid EC2 instance type.",
            "Default": "i3.4xlarge",
            "Description": "StorReduce EC2 instance type",
            "Type": "String"
        },
        "KeyPairName": {
            "ConstraintDescription": "must be the name of an existing EC2 KeyPair.",
            "Description": "Name of an existing EC2 KeyPair to enable SSH access to the instances",
            "Type": "AWS::EC2::KeyPair::KeyName"
        },
        "MonitorInstanceType": {
            "AllowedValues": [
                "i3.large",
                "i3.xlarge",
                "i3.2xlarge",
                "i3.4xlarge",
                "i3.8xlarge",
                "i3.16xlarge"
            ],
            "ConstraintDescription": "must be a valid EC2 instance type.",
            "Default": "i3.large",
            "Description": "EC2 instance type",
            "Type": "String"
        },
        "NumSRRHosts": {
            "AllowedValues": [
                3,
                5,
                7,
                9,
                11,
                13,
                15,
                17,
                19,
                21,
                23,
                25,
                27,
                29,
                31
            ],
            "ConstraintDescription": "Number of StorReduce hosts must be an odd number between 3 and 31.",
            "Description": "The number of StorReduce hosts to configure",
            "MaxValue": 31,
            "MinValue": 3,
            "Type": "Number"
        },
        "PrivateSubnetsToSpan": {
            "Description": "A list of VPC private subnets to span for StorReduce instances to reside. This number must equal the number of availability zones specified",
            "Type": "List<AWS::EC2::Subnet::Id>"
        },
        "PublicSubnetsToSpan": {
            "Description": "A list of VPC public subnets to span for the StorReduce Load Balancer to cover",
            "Type": "List<AWS::EC2::Subnet::Id>"
        },
        "QSS3BucketName": {
            "AllowedPattern": "^[0-9a-zA-Z]+([0-9a-zA-Z\\-]*[0-9a-zA-Z])*$",
            "ConstraintDescription": "Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).",
            "Default": "gong-cf-templates",
            "Description": "S3 bucket name for the Quick Start assets. Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-)",
            "Type": "String"
        },
        "QSS3KeyPrefix": {
            "AllowedPattern": "^[0-9a-zA-Z\\-/]*$",
            "ConstraintDescription": "Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).",
            "Default": "",
            "Description": "S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/)",
            "Type": "String"
        },
        "RemoteAccessCIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/x",
            "Description": "Allowed CIDR block for bastion, StorReduce Monitor and load balancer access",
            "Type": "String"
        },
        "ReplicaShardsNum": {
            "Description": "The number of replica shards to use for the StorReduce cluster. Replicas create redundancy for higher resiliency but use extra CPU and disk space",
            "MinValue": 0,
            "Type": "Number"
        },
        "SSLCertificateId": {
            "Description": "The SSL Certificate ID to use for the load balancer",
            "Type": "String"
        },
        "ShardsNum": {
            "Description": "The number of shards to use for StorReduce. Set to 0 for automatic configuration (i.e. 12 * number of servers)",
            "MinValue": 0,
            "Type": "Number"
        },
        "StorReduceLicense": {
            "ConstraintDescription": "must be a current and valid StorReduce license.",
            "Description": "A StorReduce license",
            "Type": "String"
        },
        "StorReducePassword": {
            "Description": "Password for the StorReduce admin root user",
            "NoEcho": true,
            "Type": "String"
        },
        "VPCCIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.0.0/16",
            "Description": "CIDR Block for the VPC",
            "Type": "String"
        },
        "ValidationDomainName": {
            "Description": "The validation domain name to be used to validate domain ownership for an SSL certificate (not required if SSLCertificateId exists)",
            "Type": "String"
        },
        "VpcId": {
            "ConstraintDescription": "Your VPC-ID must be in the form vpc-xxxxxxxx where 'x' can be a number or a letter.",
            "Description": "VPC-ID of your existing Virtual Private Cloud (VPC) where you want to deploy a StorReduce cluster",
            "Type": "AWS::EC2::VPC::Id"
        }
    },
    "Resources": {
        "AllInternalAccessSecurityGroup": {
            "Properties": {
                "GroupDescription": "Enables StorReduce and SSH ports TCP access from within the VPC",
                "SecurityGroupIngress": [
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "22",
                        "IpProtocol": "tcp",
                        "ToPort": "22"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "80",
                        "IpProtocol": "tcp",
                        "ToPort": "80"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "443",
                        "IpProtocol": "tcp",
                        "ToPort": "443"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "8095",
                        "IpProtocol": "tcp",
                        "ToPort": "8099"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "2379",
                        "IpProtocol": "tcp",
                        "ToPort": "2380"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "8080",
                        "IpProtocol": "tcp",
                        "ToPort": "8080"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "5044",
                        "IpProtocol": "tcp",
                        "ToPort": "5044"
                    },
                    {
                        "CidrIp": {
                            "Ref": "VPCCIDR"
                        },
                        "FromPort": "9090",
                        "IpProtocol": "tcp",
                        "ToPort": "9090"
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "EIPAssoc1": {
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "EIPMonitor",
                        "AllocationId"
                    ]
                },
                "NetworkInterfaceId": {
                    "Ref": "Eth0"
                },
                "PrivateIpAddress": {
                    "Fn::GetAtt": [
                        "Eth0",
                        "PrimaryPrivateIpAddress"
                    ]
                }
            },
            "Type": "AWS::EC2::EIPAssociation"
        },
        "EIPMonitor": {
            "Properties": {
                "Domain": "vpc"
            },
            "Type": "AWS::EC2::EIP"
        },
        "ElasticLoadBalancer": {
            "Properties": {
                "CrossZone": "true",
                "HealthCheck": {
                    "HealthyThreshold": "3",
                    "Interval": "30",
                    "Target": "HTTP:80/health_check",
                    "Timeout": "5",
                    "UnhealthyThreshold": "5"
                },
                "Listeners": [
                    {
                        "InstancePort": "80",
                        "InstanceProtocol": "TCP",
                        "LoadBalancerPort": "80",
                        "Protocol": "TCP"
                    },
                    {
                        "InstancePort": "443",
                        "InstanceProtocol": "SSL",
                        "LoadBalancerPort": "443",
                        "Protocol": "SSL",
                        "SSLCertificateId": {
                            "Fn::If": [
                                "SSLCertificateIdIsUndefined",
                                {
                                    "Ref": "StorReduceSSLCertificate"
                                },
                                {
                                    "Ref": "SSLCertificateId"
                                }
                            ]
                        }
                    }
                ],
                "SecurityGroups": [
                    {
                        "Ref": "LoadBalancerSecurityGroup"
                    }
                ],
                "Subnets": {
                    "Ref": "PublicSubnetsToSpan"
                }
            },
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer"
        },
        "Eth0": {
            "DependsOn": "AllInternalAccessSecurityGroup",
            "Properties": {
                "Description": "eth0",
                "GroupSet": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    },
                    {
                        "Ref": "MonitorSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PublicSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Interface",
                        "Value": "eth0"
                    },
                    {
                        "Key": "Name",
                        "Value": "Interface 0"
                    }
                ]
            },
            "Type": "AWS::EC2::NetworkInterface"
        },
        "LoadBalancerSecurityGroup": {
            "Properties": {
                "GroupDescription": "Enables remote access to port 80 and 443 for the StorReduce load balancer",
                "SecurityGroupIngress": [
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "80",
                        "IpProtocol": "tcp",
                        "ToPort": "80"
                    },
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "443",
                        "IpProtocol": "tcp",
                        "ToPort": "443"
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "MonitorInstance": {
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": [
                "StorReduceInstance0",
                "StorReduceHostProfile"
            ],
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "monitor-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/monitor-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "'"
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/monitor-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/monitor-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "MonitorAMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "MonitorInstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "NetworkInterfaces": [
                    {
                        "DeviceIndex": "0",
                        "NetworkInterfaceId": {
                            "Ref": "Eth0"
                        }
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SRRMonitorVM"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource MonitorInstance --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource MonitorInstance --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "MonitorSecurityGroup": {
            "Properties": {
                "GroupDescription": "Enables remote access to port 3000 and 5601 for StorReduce monitor",
                "SecurityGroupIngress": [
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "5000",
                        "IpProtocol": "tcp",
                        "ToPort": "5000"
                    },
                    {
                        "CidrIp": {
                            "Ref": "RemoteAccessCIDR"
                        },
                        "FromPort": "5601",
                        "IpProtocol": "tcp",
                        "ToPort": "5601"
                    }
                ],
                "VpcId": {
                    "Ref": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "SrrBucket": {
            "DeletionPolicy": "Retain",
            "Properties": {
                "BucketName": {
                    "Ref": "BucketName"
                }
            },
            "Type": "AWS::S3::Bucket"
        },
        "StorReduceHostProfile": {
            "DependsOn": "StorReduceHostRole",
            "Properties": {
                "Path": "/",
                "Roles": [
                    {
                        "Ref": "StorReduceHostRole"
                    }
                ]
            },
            "Type": "AWS::IAM::InstanceProfile"
        },
        "StorReduceHostRole": {
            "DependsOn": "SrrBucket",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": [
                                "sts:AssumeRole"
                            ],
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "ec2.amazonaws.com"
                                ]
                            }
                        }
                    ],
                    "Version": "2012-10-17"
                },
                "Path": "/",
                "Policies": [
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "s3:GetObject"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::Sub": [
                                            "arn:${Partition}:s3:::${QSS3BucketName}/${QSS3KeyPrefix}*",
                                            {
                                                "Partition": {
                                                    "Fn::If": [
                                                        "GovCloudCondition",
                                                        "aws-us-gov",
                                                        "aws"
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "aws-quick-start-s3-policy"
                    },
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "s3:ListBucket",
                                        "s3:ListBucketMultipartUploads"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:s3:::",
                                                {
                                                    "Ref": "BucketName"
                                                }
                                            ]
                                        ]
                                    }
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "srr-quick-start-s3-policy-bucket"
                    },
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "s3:PutObject",
                                        "s3:GetObject",
                                        "s3:DeleteObject",
                                        "s3:ListMultipartUploadParts",
                                        "s3:AbortMultipartUpload"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "arn:aws:s3:::",
                                                {
                                                    "Ref": "BucketName"
                                                },
                                                "/*"
                                            ]
                                        ]
                                    }
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "srr-quick-start-s3-policy-objects"
                    },
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "elasticloadbalancing:Describe*",
                                        "elasticloadbalancing:DeregisterInstancesFromLoadBalancer",
                                        "elasticloadbalancing:RegisterInstancesWithLoadBalancer",
                                        "autoscaling:Describe*",
                                        "autoscaling:EnterStandby",
                                        "autoscaling:ExitStandby",
                                        "autoscaling:UpdateAutoScalingGroup",
                                        "autoscaling:SuspendProcesses",
                                        "autoscaling:ResumeProcesses"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": "*"
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "elb-join-policy"
                    }
                ]
            },
            "Type": "AWS::IAM::Role"
        },
        "StorReduceInstance0": {
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": [
                "ElasticLoadBalancer",
                "SrrBucket",
                "StorReduceHostProfile",
                "AllInternalAccessSecurityGroup"
            ],
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "init-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/init-srr.sh \"",
                                            {
                                                "Ref": "BucketName"
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReduceLicense"
                                            },
                                            "' ",
                                            "'",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "'",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "' ",
                                            "'",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "ElasticLoadBalancer",
                                                    "DNSName"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/init-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/init-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrBaseHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance0 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance0 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance1": {
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance0",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance1 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance1 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance10": {
            "Condition": "NumInstancesLessThanOrEqualTo11",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance9",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance10 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance10 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance11": {
            "Condition": "NumInstancesLessThanOrEqualTo12",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance10",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance11 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance11 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance12": {
            "Condition": "NumInstancesLessThanOrEqualTo13",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance11",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance12 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance12 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance13": {
            "Condition": "NumInstancesLessThanOrEqualTo14",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance12",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance13 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance13 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance14": {
            "Condition": "NumInstancesLessThanOrEqualTo15",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance13",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance14 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance14 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance15": {
            "Condition": "NumInstancesLessThanOrEqualTo16",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance14",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance15 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance15 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance16": {
            "Condition": "NumInstancesLessThanOrEqualTo17",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance15",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance16 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance16 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance17": {
            "Condition": "NumInstancesLessThanOrEqualTo18",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance16",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance17 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance17 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance18": {
            "Condition": "NumInstancesLessThanOrEqualTo19",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance17",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance18 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance18 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance19": {
            "Condition": "NumInstancesLessThanOrEqualTo20",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance18",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance19 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance19 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance2": {
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "MonitorInstance",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance2 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance2 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance20": {
            "Condition": "NumInstancesLessThanOrEqualTo21",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance19",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance20 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance20 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance21": {
            "Condition": "NumInstancesLessThanOrEqualTo22",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance20",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance21 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance21 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance22": {
            "Condition": "NumInstancesLessThanOrEqualTo23",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance21",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance22 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance22 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance23": {
            "Condition": "NumInstancesLessThanOrEqualTo24",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance22",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance23 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance23 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance24": {
            "Condition": "NumInstancesLessThanOrEqualTo25",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance23",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance24 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance24 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance25": {
            "Condition": "NumInstancesLessThanOrEqualTo26",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance24",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance25 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance25 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance26": {
            "Condition": "NumInstancesLessThanOrEqualTo27",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance25",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance26 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance26 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance27": {
            "Condition": "NumInstancesLessThanOrEqualTo28",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance26",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance27 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance27 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance28": {
            "Condition": "NumInstancesLessThanOrEqualTo29",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance27",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance28 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance28 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance29": {
            "Condition": "NumInstancesLessThanOrEqualTo30",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance28",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance29 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance29 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance3": {
            "Condition": "NumInstancesLessThanOrEqualTo4",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance2",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance3 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance3 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance30": {
            "Condition": "NumInstancesLessThanOrEqualTo31",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance29",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance30 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance30 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance4": {
            "Condition": "NumInstancesLessThanOrEqualTo5",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance3",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance4 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance4 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance5": {
            "Condition": "NumInstancesLessThanOrEqualTo6",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance4",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance5 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance5 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance6": {
            "Condition": "NumInstancesLessThanOrEqualTo7",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance5",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance6 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance6 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance7": {
            "Condition": "NumInstancesLessThanOrEqualTo8",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance6",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance7 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance7 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance8": {
            "Condition": "NumInstancesLessThanOrEqualTo9",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance7",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance8 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance8 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceInstance9": {
            "Condition": "NumInstancesLessThanOrEqualTo10",
            "CreationPolicy": {
                "ResourceSignal": {
                    "Timeout": "PT15M"
                }
            },
            "DependsOn": "StorReduceInstance8",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ],
                        "roleName": {
                            "Ref": "StorReduceHostRole"
                        },
                        "type": "S3"
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "commands": {
                            "connect-srr": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/home/ec2-user/connect-srr.sh \"",
                                            {
                                                "Fn::GetAtt": [
                                                    "StorReduceInstance0",
                                                    "PrivateDnsName"
                                                ]
                                            },
                                            "\" '",
                                            {
                                                "Ref": "StorReducePassword"
                                            },
                                            "' ",
                                            "\"",
                                            {
                                                "Ref": "ShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ReplicaShardsNum"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "ElasticLoadBalancer"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Fn::GetAtt": [
                                                    "Eth0",
                                                    "PrimaryPrivateIpAddress"
                                                ]
                                            },
                                            "\" ",
                                            "\"",
                                            {
                                                "Ref": "NumSRRHosts"
                                            },
                                            "\""
                                        ]
                                    ]
                                }
                            }
                        },
                        "files": {
                            "/home/ec2-user/connect-srr.sh": {
                                "group": "root",
                                "mode": "000550",
                                "owner": "root",
                                "source": {
                                    "Fn::Sub": [
                                        "https://${QSS3BucketName}.${QSS3Region}.amazonaws.com/${QSS3KeyPrefix}scripts/connect-srr.sh",
                                        {
                                            "QSS3Region": {
                                                "Fn::If": [
                                                    "GovCloudCondition",
                                                    "s3-us-gov-west-1",
                                                    "s3"
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            },
            "Properties": {
                "IamInstanceProfile": {
                    "Ref": "StorReduceHostProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegion",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "InstanceType": {
                    "Ref": "InstanceType"
                },
                "KeyName": {
                    "Ref": "KeyPairName"
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "AllInternalAccessSecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "PrivateSubnetsToSpan"
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SrrHost"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "\n    #!/bin/bash -xe\n    /opt/aws/bin/cfn-init -v --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                " --resource StorReduceInstance9 --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "/opt/aws/bin/cfn-signal -e $? --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "    --resource StorReduceInstance9 --region ",
                                {
                                    "Ref": "AWS::Region"
                                }
                            ]
                        ]
                    }
                }
            },
            "Type": "AWS::EC2::Instance"
        },
        "StorReduceSSLCertificate": {
            "Condition": "SSLCertificateIdIsUndefined",
            "Properties": {
                "DomainName": {
                    "Ref": "DomainName"
                },
                "DomainValidationOptions": [
                    {
                        "DomainName": {
                            "Ref": "DomainName"
                        },
                        "ValidationDomain": {
                            "Ref": "ValidationDomainName"
                        }
                    }
                ]
            },
            "Type": "AWS::CertificateManager::Certificate"
        }
    }
}
